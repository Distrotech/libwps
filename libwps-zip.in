#!/bin/sh

# Build runtime and developer zipfiles for libwps on Win32.

ZIP=libwps-@WPS_VERSION@-MinGW.zip
DEVZIP=libwps-devel-@WPS_VERSION@-MinGW.zip

cd $DESTDIR@prefix@

DLLDIR=lib
[ -f bin/libwps-@WPS_MAJOR_VERSION@.@WPS_MINOR_VERSION@.dll ] && \
[ -f bin/libwps-stream-@WPS_MAJOR_VERSION@.@WPS_MINOR_VERSION@.dll ] && \
DLLDIR=bin

@STRIP@ --strip-all \
$DLLDIR/libwps-@WPS_MAJOR_VERSION@.@WPS_MINOR_VERSION@.dll \
$DLLDIR/libwps-stream-@WPS_MAJOR_VERSION@.@WPS_MINOR_VERSION@.dll \

upx -qqq --best \
$DLLDIR/libwps-@WPS_MAJOR_VERSION@.@WPS_MINOR_VERSION@.dll \
$DLLDIR/libwps-stream-@WPS_MAJOR_VERSION@.@WPS_MINOR_VERSION@.dll \

rm $ZIP
zip $ZIP -@ <<EOF
$DLLDIR/libwps-@WPS_MAJOR_VERSION@.@WPS_MINOR_VERSION@.dll
$DLLDIR/libwps-stream-@WPS_MAJOR_VERSION@.@WPS_MINOR_VERSION@.dll
EOF

rm $DEVZIP
zip -r $DEVZIP -@ <<EOF
include/libwps-@WPS_MAJOR_VERSION@.@WPS_MINOR_VERSION@
lib/libwps-@WPS_MAJOR_VERSION@.@WPS_MINOR_VERSION@.dll.a
lib/libwps-stream-@WPS_MAJOR_VERSION@.@WPS_MINOR_VERSION@.dll.a
lib/libwps-@WPS_MAJOR_VERSION@.@WPS_MINOR_VERSION@.a
lib/libwps-stream-@WPS_MAJOR_VERSION@.@WPS_MINOR_VERSION@.a
lib/pkgconfig/libwps-@WPS_MAJOR_VERSION@.@WPS_MINOR_VERSION@.pc
lib/pkgconfig/libwps-stream-@WPS_MAJOR_VERSION@.@WPS_MINOR_VERSION@.pc
EOF
